<% provide(:title, "Inscripciones") %>
<div class="alert alert-notice" id="alert_notice">Oops! No tienes los permisos suficientes para llevar a cabo esta tarea.</div>

<div class="boton_der">
	<div class="top_buttons">
		<%= link_to group_path(@group) do %>
			<p><button type="button" class="btn btn-info">Regresar al Grupo</button></p>
		<% end %>
	</div>
	<h1>Inscripciones<span class="line"></span></h1>
</div>
<div class="panel panel-primary top_panel">
	<div class="group_info">

		<% grantotal = 0
		granfaltante = 0 %>
		<% @group.spots.each_with_index do |spot,index| %>
			<% total = 0
			faltante = 0 %>
			<% spot.payments.each { |p| total = total + p.amount } %>
				<% faltante = @group.cost-total
				granfaltante = granfaltante + faltante
				grantotal = grantotal + total %>
			<% end %>	

		<li><strong>Pagos del Grupo:</strong>$<%= grantotal %></li>
		<li><strong>Saldos del Grupo:</strong>$<%= granfaltante %></li>
  </div>
</div>
<div class="spacer"></div>
<% if(@childs) %>
 	<div class="light_box all_width">
	 	<div id="total_spots">
			<h4><span><%= @group.spots.count %></span> Inscritos</h4>
			<div class="under_pressure"></div>
		</div>
 		<div class="all_width blue_box">
 			<div id="enlist_childs" class="white_box">
 				<% if @group.spots.count>0 %>
					<% @group.spots.each do |c| %>
						<div class="child_spot child_appended" id="child_spot_<%= c.child.id %>">
							<img src="<%= c.child.photo_url(:thumb) %>" alt="<%= c.child.name %>" class="kid_up_photo">
							<div class="kid_stats">
								<p><%= c.child.name %></p>
								<p><%= ("#{ c.child.first_last_name } #{ c.child.second_last_name }").slice(0..13) %>.</p>
							</div>
							<% if c.can_destroy? %>
								<div class="child_remove">
									<a href="/spots/destroy?id=<%= c.id %>&group_id=<%= @group.id %>" data-remote="true" title="Eliminar">
										<span class="glyphicon glyphicon-remove"></span>
									</a>
								</div>
							<% end %>
						</div>
					<% end %>
				<% else %>
					<h4 class="counter_is_zero">Aún no hay ningún niño inscrito en este grupo</h4>
				<% end %>				
			</div>
		</div>

		<div class="under_pressure"></div>
		<h4><%= "Niños de #{@group.min_age} a #{@group.max_age} meses" %></h4>
		<% if @childs.count>0 %>
			<div class="under_pressure"></div>
			<div id="posibble_childs" class="all_width blue_box">
				<div class="white_box">
					<% @childs.each_with_index do |c,index| %>
						<% if c.families.first %>
							<% if c.families.first.status %>
								<a href="/spots/create?child_id=<%= c.id %>&group_id=<%= @group.id %>" data-remote="true"  class="child_selector child_<%= c.id %>" id="child_selector_<%= index %>" data-childid="<%= c.id %>" data-weeks="<%= ((Date.today.to_date - c.dob.to_date).to_i)/7 %>">
									<div class="child_spot child_appended">
										<img src="<%= c.photo_url(:thumb) %>" alt="<%= c.name %>" class="attendance_img">
										<div class="weeks_stat">
											<p><span><%= ((Date.today.to_date - c.dob.to_date).to_i)/7 %></span><br>Semanas</p>
										</div>
										<div class="kid_stats">
											<p><%= c.name %></p>
											<p><%= ("#{ c.first_last_name } #{ c.second_last_name }").slice(0..13) %>.</p>
										</div>
										<div class="child_selected">
											<span class="glyphicon glyphicon-ok"></span>
										</div>
									</div>
								</a>
							<% end %>
						<% end %>
					<% end %>
				</div>
			</div>
		<% else %>
			<div class="under_pressure"></div>
			<div id="posibble_childs" class="all_width blue_box">
				<h4 class="counter_is_zero">No se encontraron niños dentro del rango de edad</h4>
			</div>
		<% end %>

		<div class="spacer"></div>
		<h4>Búsqueda</h4>
		<div class="under_pressure"></div>
		<div class="blue_box">
			<div id="searcher" class="all_width white_box">
				<%= form_tag("/spots/search", :method => "get", remote: true, :id => "search_form") do %>
					<%= text_field_tag "query", nil, :placeholder => "Buscar", :class => "search_input form-control" %>
					<%= text_field_tag "group_id", "#{@group.id}", :style => 'display:none;' %>
				<% end %>
				<div id="childs_container"></div>
			</div>
		</div>
	</div>
<% end %>
<script>
	$(document).ready(function() {
		<%= render "/spots/edit.js.erb" %>
		$(".child_appended").each(function(index, el) {
			$(this).delay(index*80).animate({top:0,opacity:1},600,'easeOutQuart');
		});
	});
</script>