<div id="loader">
	<img src="/assets/person_loader.GIF" alt="">
	GUARDANDO
</div>
<% provide(:title, "#{@program.name} ( #{@program.min_age} - #{@program.max_age} semanas )") %>
<div class="boton_der">
	<div class="top_buttons">
		<%= link_factory( :_path => programs_path, :_text => "Regresar a Programas", _class: 'btn btn-info', _button: true ) %>
		<%= link_factory( :_path => edit_program_path(@program), :_text => "Editar Programa", _class: 'btn btn-default', _button: true ) %>
	</div>
	<h1><%= "#{@program.name} ( #{@program.min_age} - #{@program.max_age} semanas )" %><span class="line"></span></h1>
</div>
<div id="container_program_relations">
	<div class="light_box" style="height:352px;">
		<div id="refresh_programs_relations">
			<%= render 'program_relations/show' %>
		</div>
	</div>
	<div class="spacer"></div>
	<div class="light_box">
		<div id="reorder_container" class="col-md-12">
			<div class="boton_der">
				<div id="reorder_days">
					<h4>Clases</h4>
					<div id="program_relation_actions">
						<a href="#" data-remote="true" id="disable_admin">
						<p><button type="button" class="btn btn-danger btn-xs">Cancelar</button></p>
						</a>
						<a href="#" data-remote="true" id="save_admin">
						<p><button type="button" class="btn btn-default btn-xs">Guardar Cambios</button></p>
						</a>
						<a href="#" data-remote="true" id="active_admin">
						<p><button type="button" class="btn btn-primary btn-xs">Reordenar</button></p>
						</a>
					</div>
				</div>
			</div>
			<div id="accordion_content">
				<div class="col-md-12 blue_box">
					<div class="col-md-12 white_box" id="container_orders">
						<ul id="reorder-days">
							<% @program.lessons.each do |lesson| %>
							<li class="reorder-item  ui-state-default" data-order="<%= lesson.order_day %>">
								<a href="#" class="remove_day animate" title="Quitar dÃ­a" data-remote="true">x</a>
								<a href="/program_relations/<%= @program.id %>?lesson_id=<%= lesson.id %>" class="number_of_activities" data-remote="true" >
								<div class="order_day">Clase <%= "#{lesson.order_day}" %></div>
								<div class="program_relations_points">
									<% lesson.program_relations.count.times do |p| %>
									<span class="program_relation_point"></span>
									<% end %>
								</div>
								</a>
							</li>
							<% end %>
						</ul>
					</div>
				</div>
			</div>
			<div class="spacer"></div>
		</div>
	</div>
</div>
<script>
	$(document).ready(function() {
		
		$("#active_admin").on("click",active_admin);
		$("#disable_admin").on("click",disable_admin);
		$("#save_admin").on("click",send_sessions);

		$("#reorder-days").sortable({ placeholder: "reorder-highlight" });
		$("#reorder-days").disableSelection();

		disable_admin();

	});

	function send_sessions(){
		$("#loader").fadeIn();
		$("#container_program_relations").fadeOut();
		var order=[];
		$('.reorder-item').not('.removed_item').each(function(){
			var day = $(this).data('order');
			order.push(day);
		});
		console.log(order);
	}

	function active_admin(){
		$("#active_admin").hide();
		$("#reorder-days").sortable("enable");
		$("#disable_admin, #save_admin").show();		
		$(".number_of_activities").css({cursor:'move'});
		$(".remove_day").css({opacity:1}).on("click",function(){
			$(this).parent().fadeOut().addClass('removed_item');
		});
	}

	function disable_admin(){
		$("#active_admin").show();
		$("#disable_admin, #save_admin").hide();
		$(".number_of_activities").removeAttr('style');
		$('.reorder-item').fadeIn().removeClass('removed_item');
		$(".remove_day").css({opacity:0}).off();
		$("#reorder-days").sortable("disable");
	}

</script>